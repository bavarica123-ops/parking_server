<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì£¼ì°¨ ì°¨ëŸ‰ ê´€ë¦¬</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 40px;
      }
      h1 {
        margin-bottom: 20px;
      }
      input {
        padding: 8px;
        font-size: 16px;
      }
      button {
        padding: 8px 16px;
        margin-left: 8px;
        cursor: pointer;
      }
      table {
        margin: 20px auto;
        border-collapse: collapse;
        width: 60%;
      }
      th, td {
        border: 1px solid #333;
        padding: 10px;
      }
      .confirmed {
        background-color: #90ee90; /* ì´ˆë¡ìƒ‰ */
      }
      .unconfirmed {
        background-color: #ffb3b3; /* ë¹¨ê°„ìƒ‰ */
      }
    </style>
  </head>
  <body>
    <h1>ğŸš— ë“±ë¡ëœ ì°¨ëŸ‰ ëª©ë¡</h1>

    <div>
      <input id="carNumber" type="text" maxlength="4" placeholder="ë²ˆí˜¸ ì…ë ¥ (ë’¤ 4ìë¦¬)" />
      <button onclick="confirmCar()">í™•ì¸</button>
    </div>

    <p id="message" style="color: red; font-weight: bold;"></p>

    <table id="carTable">
      <thead>
        <tr>
          <th>ì°¨ëŸ‰ë²ˆí˜¸</th>
          <th>ì‹œê°„</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const socket = io("https://parking-server-6uo8.onrender.com");
      const carTableBody = document.querySelector("#carTable tbody");
      const message = document.getElementById("message");

      function updateTable(data) {
        carTableBody.innerHTML = "";
        data.forEach((car) => {
          const row = document.createElement("tr");
          row.className = car.confirmed ? "confirmed" : "unconfirmed";
          row.innerHTML = `
            <td>${car.number}</td>
            <td>${car.time ? new Date(car.time).toLocaleTimeString() : "-"}</td>
            <td>${car.confirmed ? "í™•ì¸ë¨" : "ë¯¸í™•ì¸"}</td>
          `;
          carTableBody.appendChild(row);
        });
      }

      socket.on("update", (data) => {
        console.log("ğŸ“¡ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :", data);
        updateTable(data);
      });

      function confirmCar() {
        const num = document.getElementById("carNumber").value.trim();
        if (!num) return;

        fetch("https://parking-server-6uo8.onrender.com/confirm", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ number: num }),
        })
          .then((res) => {
            if (res.ok) {
              message.textContent = "";
            } else {
              message.textContent = "ë“±ë¡ëœ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
            }
          })
          .catch((err) => {
            console.error(err);
            message.textContent = "ì„œë²„ ì˜¤ë¥˜ ë°œìƒ.";
          });

        document.getElementById("carNumber").value = "";
      }
    </script>
  </body>
</html>
